<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" agent="Claude Code" version="29.3.8">
  <diagram name="Custody Indexer Architecture" id="arch">
    <mxGraphModel dx="1633" dy="1100" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- ==================== LEGEND ==================== -->
        <mxCell id="legend_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#CCCCCC;strokeWidth=1;" value="" vertex="1">
          <mxGeometry x="40" y="40" width="195" height="160" as="geometry" />
        </mxCell>
        <mxCell id="legend_title" parent="1" style="text;html=1;align=left;verticalAlign=middle;fontSize=12;fontStyle=1;" value="Legend" vertex="1">
          <mxGeometry x="55" y="46" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg1_line" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#2D7600;strokeWidth=2;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="80" as="sourcePoint" />
            <mxPoint x="85" y="80" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="leg1" parent="1" style="text;html=1;align=left;verticalAlign=middle;fontSize=10;fontColor=#2D7600;" value="Data flow (Go ch)" vertex="1">
          <mxGeometry x="90" y="72" width="130" height="16" as="geometry" />
        </mxCell>
        <mxCell id="leg5_line" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#b85450;strokeWidth=2;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="100" as="sourcePoint" />
            <mxPoint x="85" y="100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="leg5" parent="1" style="text;html=1;align=left;verticalAlign=middle;fontSize=10;fontColor=#b85450;" value="gRPC (sidecar)" vertex="1">
          <mxGeometry x="90" y="92" width="120" height="16" as="geometry" />
        </mxCell>
        <mxCell id="leg3_line" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#9673a6;strokeWidth=2;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="120" as="sourcePoint" />
            <mxPoint x="85" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="leg3" parent="1" style="text;html=1;align=left;verticalAlign=middle;fontSize=10;fontColor=#9673a6;" value="Storage I/O" vertex="1">
          <mxGeometry x="90" y="112" width="120" height="16" as="geometry" />
        </mxCell>
        <mxCell id="leg4_line" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#d6b656;strokeWidth=1.5;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="140" as="sourcePoint" />
            <mxPoint x="85" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="leg4" parent="1" style="text;html=1;align=left;verticalAlign=middle;fontSize=10;fontColor=#d6b656;" value="Plugin routing" vertex="1">
          <mxGeometry x="90" y="132" width="120" height="16" as="geometry" />
        </mxCell>
        <mxCell id="leg6_line" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#999999;strokeWidth=1;dashed=1;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="160" as="sourcePoint" />
            <mxPoint x="85" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="leg6" parent="1" style="text;html=1;align=left;verticalAlign=middle;fontSize=10;fontColor=#999999;" value="Future / optional" vertex="1">
          <mxGeometry x="90" y="152" width="120" height="16" as="geometry" />
        </mxCell>
        <mxCell id="leg7_line" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#666666;strokeWidth=2;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="55" y="180" as="sourcePoint" />
            <mxPoint x="85" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="leg7" parent="1" style="text;html=1;align=left;verticalAlign=middle;fontSize=10;fontColor=#666666;" value="External RPC" vertex="1">
          <mxGeometry x="90" y="172" width="120" height="16" as="geometry" />
        </mxCell>

        <!-- ==================== BLOCKCHAIN RPC ==================== -->
        <mxCell id="rpc" parent="1" style="shape=cloud;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;fontSize=12;verticalAlign=middle;" value="&lt;b&gt;Blockchain RPC&lt;/b&gt;&lt;br&gt;Solana Devnet" vertex="1">
          <mxGeometry x="40" y="340" width="170" height="100" as="geometry" />
        </mxCell>

        <!-- ==================== GO PIPELINE ==================== -->
        <mxCell id="go_lane" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#4D9900;strokeWidth=2;dashed=1;arcSize=8;" value="" vertex="1">
          <mxGeometry x="270" y="30" width="830" height="500" as="geometry" />
        </mxCell>
        <mxCell id="go_label" parent="1" style="text;html=1;align=left;verticalAlign=top;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;fontSize=13;fontColor=#2D7600;spacingLeft=6;spacingTop=2;spacingRight=6;spacingBottom=2;" value="&lt;b&gt;Go Pipeline Process&lt;/b&gt;" vertex="1">
          <mxGeometry x="280" y="38" width="155" height="26" as="geometry" />
        </mxCell>

        <!-- Coordinator -->
        <mxCell id="coord" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;verticalAlign=top;spacingTop=2;align=center;" value="&lt;b&gt;Coordinator&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#888;&#39;&gt;1 goroutine · ticker-based&lt;/font&gt;&lt;hr size=&#39;1&#39;/&gt;watched_addresses scan&lt;br&gt;Cursor watermark sync&lt;br&gt;FetchJob dispatch" vertex="1">
          <mxGeometry x="310" y="85" width="190" height="110" as="geometry" />
        </mxCell>

        <!-- Redis (future) -->
        <mxCell id="redis" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;verticalAlign=middle;strokeDashArray=4 4;" value="&lt;b&gt;Redis 7&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:10px;color:#888;&#39;&gt;Streams + Keys&lt;br&gt;(future)&lt;/font&gt;" vertex="1">
          <mxGeometry x="610" y="90" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Fetcher Pool -->
        <mxCell id="fetch" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;verticalAlign=top;spacingTop=2;align=center;" value="&lt;b&gt;Fetcher Pool&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#888;&#39;&gt;N workers (default 2)&lt;/font&gt;&lt;hr size=&#39;1&#39;/&gt;getSignaturesForAddress&lt;br&gt;getTransaction × N (parallel)&lt;br&gt;Retry / backoff" vertex="1">
          <mxGeometry x="310" y="260" width="190" height="110" as="geometry" />
        </mxCell>

        <!-- Normalizer -->
        <mxCell id="norm" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;verticalAlign=top;spacingTop=2;align=center;" value="&lt;b&gt;Normalizer&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#888;&#39;&gt;N workers (default 2)&lt;/font&gt;&lt;hr size=&#39;1&#39;/&gt;gRPC decode call&lt;br&gt;BalanceEventInfo → model&lt;br&gt;NormalizedBatch 구성" vertex="1">
          <mxGeometry x="570" y="260" width="190" height="110" as="geometry" />
        </mxCell>

        <!-- Ingester -->
        <mxCell id="ingest" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;verticalAlign=top;spacingTop=2;align=center;" value="&lt;b&gt;Ingester&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#888;&#39;&gt;1 goroutine · single-writer&lt;/font&gt;&lt;hr size=&#39;1&#39;/&gt;Upsert balance_events&lt;br&gt;Signed delta → balance&lt;br&gt;Atomic sql.Tx + cursor" vertex="1">
          <mxGeometry x="830" y="260" width="210" height="110" as="geometry" />
        </mxCell>

        <!-- Finalizer (future) -->
        <mxCell id="final" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#CCCCCC;fontSize=11;verticalAlign=top;spacingTop=2;align=center;strokeDashArray=4 4;" value="&lt;b&gt;Finalizer&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#888;&#39;&gt;reorg chain only · future&lt;/font&gt;&lt;hr size=&#39;1&#39;/&gt;Confirmation 조회&lt;br&gt;FinalizeTx 발행" vertex="1">
          <mxGeometry x="830" y="420" width="210" height="90" as="geometry" />
        </mxCell>

        <!-- ==================== EXTERNAL STORAGE ==================== -->

        <!-- PostgreSQL -->
        <mxCell id="pg" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;verticalAlign=middle;" value="&lt;b&gt;PostgreSQL 16&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:10px;&#39;&gt;balance_events (signed delta)&lt;br&gt;balances · tokens · JSONB&lt;/font&gt;" vertex="1">
          <mxGeometry x="1180" y="180" width="185" height="90" as="geometry" />
        </mxCell>

        <!-- Durable Store (future) -->
        <mxCell id="durable" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f5f5f5;strokeColor=#CCCCCC;fontSize=11;verticalAlign=middle;strokeDashArray=4 4;" value="&lt;b&gt;Durable Store&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:10px;color:#888;&#39;&gt;Normalized Backup&lt;br&gt;(future)&lt;/font&gt;" vertex="1">
          <mxGeometry x="1195" y="330" width="155" height="80" as="geometry" />
        </mxCell>

        <!-- ==================== NODE.JS SIDECAR ==================== -->

        <mxCell id="sc_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#AE4132;strokeWidth=2;dashed=1;arcSize=8;" value="" vertex="1">
          <mxGeometry x="370" y="580" width="490" height="280" as="geometry" />
        </mxCell>
        <mxCell id="sc_label" parent="1" style="text;html=1;align=left;verticalAlign=top;fillColor=#f8cecc;strokeColor=#b85450;rounded=1;fontSize=13;fontColor=#AE4132;spacingLeft=6;spacingTop=2;spacingRight=6;spacingBottom=2;" value="&lt;b&gt;Node.js Sidecar&lt;/b&gt; &amp;nbsp;gRPC :50051" vertex="1">
          <mxGeometry x="380" y="588" width="230" height="26" as="geometry" />
        </mxCell>

        <!-- Transaction Decoder -->
        <mxCell id="tx_decoder" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;verticalAlign=middle;align=center;" value="&lt;b&gt;Transaction Decoder&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#666;&#39;&gt;outer instruction ownership 구성&lt;/font&gt;" vertex="1">
          <mxGeometry x="395" y="628" width="180" height="50" as="geometry" />
        </mxCell>

        <!-- Plugin Dispatcher -->
        <mxCell id="dispatcher" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;verticalAlign=middle;align=center;" value="&lt;b&gt;PluginDispatcher&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#666;&#39;&gt;programId → plugin routing&lt;br&gt;priority-based selection&lt;/font&gt;" vertex="1">
          <mxGeometry x="395" y="698" width="180" height="65" as="geometry" />
        </mxCell>

        <!-- SPL Token Plugin -->
        <mxCell id="spl_plugin" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;verticalAlign=middle;align=center;" value="&lt;b&gt;generic_spl_token&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#666;&#39;&gt;SPL Token / Token-2022&lt;br&gt;transfer · transferChecked&lt;/font&gt;" vertex="1">
          <mxGeometry x="620" y="625" width="170" height="58" as="geometry" />
        </mxCell>

        <!-- System Plugin -->
        <mxCell id="sys_plugin" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;verticalAlign=middle;align=center;" value="&lt;b&gt;generic_system&lt;/b&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;color:#666;&#39;&gt;System Program&lt;br&gt;system_transfer&lt;/font&gt;" vertex="1">
          <mxGeometry x="620" y="700" width="170" height="55" as="geometry" />
        </mxCell>

        <!-- Future plugins -->
        <mxCell id="future_plugin" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#CCCCCC;fontSize=10;verticalAlign=middle;align=center;fontColor=#999;dashed=1;" value="&lt;i&gt;future plugins...&lt;/i&gt;&lt;br&gt;&lt;font style=&#39;font-size:9px;&#39;&gt;Stake / DEX / etc.&lt;/font&gt;" vertex="1">
          <mxGeometry x="620" y="772" width="170" height="40" as="geometry" />
        </mxCell>

        <!-- ==================== ANNOTATIONS ==================== -->

        <!-- 3-Layer Dedup Note -->
        <mxCell id="dedup_note" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;size=12;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;align=left;spacingLeft=6;spacingTop=4;verticalAlign=top;" value="&lt;b&gt;3-Layer Dedup&lt;/b&gt;&lt;hr size=&#39;1&#39;/&gt;&lt;font style=&#39;font-size:9px;&#39;&gt;L1: Instruction Ownership&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CPI 이중 기록 방지&lt;br&gt;L2: Plugin Priority&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;단일 플러그인 선택&lt;br&gt;L3: DB Unique Constraint&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;최종 멱등 보장&lt;/font&gt;" vertex="1">
          <mxGeometry x="40" y="530" width="195" height="130" as="geometry" />
        </mxCell>

        <!-- Backpressure Note -->
        <mxCell id="bp_note" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;size=12;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;spacingLeft=6;spacingTop=4;verticalAlign=top;" value="&lt;b&gt;Backpressure&lt;/b&gt;&lt;hr size=&#39;1&#39;/&gt;&lt;font style=&#39;font-size:9px;&#39;&gt;Buffered Go channels&lt;br&gt;propagate backpressure&lt;br&gt;naturally upstream.&lt;br&gt;&lt;br&gt;All sends: select + ctx.Done()&lt;br&gt;&lt;br&gt;Max in-flight:&lt;br&gt;3 × CHANNEL_BUFFER_SIZE&lt;/font&gt;" vertex="1">
          <mxGeometry x="40" y="685" width="195" height="150" as="geometry" />
        </mxCell>

        <!-- ==================== EDGES ==================== -->

        <!-- RPC → Fetcher -->
        <mxCell id="e_rpc_fetch" edge="1" parent="1" source="rpc" target="fetch" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_rpc_fetch_lbl" connectable="0" parent="e_rpc_fetch" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#666666;" value="HTTPS" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- Coordinator → Fetcher (jobCh) -->
        <mxCell id="e_coord_fetch" edge="1" parent="1" source="coord" target="fetch" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#2D7600;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_coord_fetch_lbl" connectable="0" parent="e_coord_fetch" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#2D7600;fontStyle=1;" value="jobCh&lt;br&gt;&lt;font style=&#39;font-weight:normal;font-size:9px;&#39;&gt;(buffered)&lt;/font&gt;" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry"><mxPoint x="22" as="offset" /></mxGeometry>
        </mxCell>

        <!-- Fetcher → Normalizer (rawBatchCh) -->
        <mxCell id="e_fetch_norm" edge="1" parent="1" source="fetch" target="norm" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#2D7600;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_fetch_norm_lbl" connectable="0" parent="e_fetch_norm" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#2D7600;fontStyle=1;" value="rawBatchCh&lt;br&gt;&lt;font style=&#39;font-weight:normal;font-size:9px;&#39;&gt;(buffered)&lt;/font&gt;" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- Normalizer → Ingester (normalizedCh) -->
        <mxCell id="e_norm_ingest" edge="1" parent="1" source="norm" target="ingest" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#2D7600;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_norm_ingest_lbl" connectable="0" parent="e_norm_ingest" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#2D7600;fontStyle=1;" value="normalizedCh&lt;br&gt;&lt;font style=&#39;font-weight:normal;font-size:9px;&#39;&gt;(BalanceEvents)&lt;/font&gt;" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- Ingester → PostgreSQL -->
        <mxCell id="e_ingest_pg" edge="1" parent="1" source="ingest" target="pg" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9673a6;strokeWidth=2;exitX=1;exitY=0.35;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1110" y="299" />
              <mxPoint x="1110" y="225" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e_ingest_pg_lbl" connectable="0" parent="e_ingest_pg" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#9673a6;" value="Atomic sql.Tx&lt;br&gt;&lt;font style=&#39;font-size:9px;&#39;&gt;upsert + cursor&lt;/font&gt;" vertex="1">
          <mxGeometry relative="1" x="0.2" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- Coordinator → PostgreSQL (read cursors) -->
        <mxCell id="e_coord_pg" edge="1" parent="1" source="coord" target="pg" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9673a6;strokeWidth=1;dashed=1;exitX=1;exitY=0.2;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1130" y="107" />
              <mxPoint x="1130" y="203" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e_coord_pg_lbl" connectable="0" parent="e_coord_pg" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#9673a6;" value="read config&lt;br&gt;&amp;amp; cursors" vertex="1">
          <mxGeometry relative="1" x="0.4" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- Coordinator → Redis (future) -->
        <mxCell id="e_coord_redis" edge="1" parent="1" source="coord" target="redis" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#d6b656;strokeWidth=1;dashed=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_coord_redis_lbl" connectable="0" parent="e_coord_redis" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#d6b656;" value="Lag / Enqueue&lt;br&gt;&lt;font style=&#39;font-size:8px;color:#999;&#39;&gt;(future)&lt;/font&gt;" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- Normalizer → Durable Store (future) -->
        <mxCell id="e_norm_durable" edge="1" parent="1" source="norm" target="durable" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9673a6;strokeWidth=1;dashed=1;exitX=1;exitY=0.8;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="810" y="348" />
              <mxPoint x="810" y="420" />
              <mxPoint x="1150" y="420" />
              <mxPoint x="1150" y="370" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e_norm_durable_lbl" connectable="0" parent="e_norm_durable" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#9673a6;" value="Backup &lt;font style=&#39;font-size:8px;color:#999;&#39;&gt;(future)&lt;/font&gt;" vertex="1">
          <mxGeometry relative="1" x="0.4" as="geometry"><mxPoint as="offset" /></mxGeometry>
        </mxCell>

        <!-- Finalizer → Ingester (future) -->
        <mxCell id="e_final_ingest" edge="1" parent="1" source="final" target="ingest" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#d6b656;strokeWidth=1;dashed=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_final_ingest_lbl" connectable="0" parent="e_final_ingest" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#d6b656;" value="FinalizeTx" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry"><mxPoint x="22" as="offset" /></mxGeometry>
        </mxCell>

        <!-- Normalizer → Sidecar (gRPC) -->
        <mxCell id="e_norm_sc" edge="1" parent="1" source="norm" target="tx_decoder" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#b85450;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_norm_sc_lbl" connectable="0" parent="e_norm_sc" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#b85450;fontStyle=1;" value="gRPC :50051" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry"><mxPoint x="26" as="offset" /></mxGeometry>
        </mxCell>

        <!-- Tx Decoder → Dispatcher -->
        <mxCell id="e_decoder_dispatch" edge="1" parent="1" source="tx_decoder" target="dispatcher" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#b85450;strokeWidth=1.5;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Dispatcher → SPL Plugin -->
        <mxCell id="e_disp_spl" edge="1" parent="1" source="dispatcher" target="spl_plugin" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#d6b656;strokeWidth=1.5;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_disp_spl_lbl" connectable="0" parent="e_disp_spl" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#d6b656;" value="priority 100" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry"><mxPoint y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <!-- Dispatcher → System Plugin -->
        <mxCell id="e_disp_sys" edge="1" parent="1" source="dispatcher" target="sys_plugin" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#d6b656;strokeWidth=1.5;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e_disp_sys_lbl" connectable="0" parent="e_disp_sys" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=9;fontColor=#d6b656;" value="priority 100" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry"><mxPoint y="-10" as="offset" /></mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
