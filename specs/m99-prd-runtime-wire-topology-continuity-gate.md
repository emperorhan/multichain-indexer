# M99 PRD Runtime-Wire Topology Continuity Gate

## Scope
- Milestone: `M99`
- Execution slice: `C0103`
- Mandatory chains: `solana-devnet`, `base-sepolia`, `btc-testnet`

## PRD Traceability
- `R6`: deployment topology independence.
- `R7`: strict chain isolation.
- `10`: deterministic replay acceptance and one-chain perturbation peer isolation.
- `chain_adapter_runtime_wired`: chain adapter wiring must remain invariant under topology and perturbation.

## Problem Statement
After `C0102` class/fee revalidation, topology/runtime wiring parity remains PRD-critical but not explicitly re-closed as a hard-stop before optional refinements. This slice creates an explicit evidence contract for one-chain perturbation and adapter topology coupling checks across mandatory chains.

## C0103 Revalidation Contract (`I-0562 -> I-0565 -> I-0566`)
- Scope focus:
  - same mandatory chains as the mandatory contract set
  - topology family parity (chain-per-deploy vs family-per-deploy behavior expectations)
  - one-chain perturbation isolation on commit boundary rows
- Hard-stop output artifacts to be generated by `I-0565`:
  - `.ralph/reports/I-0565-m99-s1-runtime-wiring-matrix.md`
  - `.ralph/reports/I-0565-m99-s2-one-chain-adapter-coupling-isolation-matrix.md`

## Matrix Contract (M99-C0103)

### Runtime wiring matrix (`I-0565-m99-s1-runtime-wiring-matrix.md`)
Required row keys:
- `fixture_id`
- `fixture_seed`
- `run_id`
- `chain`
- `network`
- `topology_mode`
- `permutation`
- `class_path`
- `canonical_event_id_unique_ok`
- `replay_idempotent_ok`
- `cursor_monotonic_ok`
- `signed_delta_conservation_ok`
- `chain_adapter_runtime_wired_ok`
- `evidence_present`
- `outcome`
- `failure_mode`

Required hard-stop outcomes for this tranche:
- `outcome=GO`
- `evidence_present=true`
- all boolean gates listed above are `true`
- `failure_mode` empty when outcome is `GO`

### Isolation matrix (`I-0565-m99-s2-one-chain-adapter-coupling-isolation-matrix.md`)
Required row keys:
- `fixture_id`
- `fixture_seed`
- `run_id`
- `chain`
- `network`
- `peer_chain`
- `topology_mode`
- `peer_cursor_delta`
- `peer_watermark_delta`
- `evidence_present`
- `outcome`
- `failure_mode`

Required hard-stop outcomes for this tranche:
- `outcome=GO`
- `evidence_present=true`
- `peer_cursor_delta=0`
- `peer_watermark_delta=0`
- `failure_mode` empty when outcome is `GO`

## Measurable Exit Gates
1. `0` missing required C0103 evidence rows for the three mandatory chains in both artifacts.
2. For required C0103 runtime rows all required invariant booleans are true for `GO` outcomes.
3. For required C0103 isolation rows `peer_cursor_delta=0` and `peer_watermark_delta=0` for all mandatory chains.
4. `outcome` must be `GO`/`NO-GO`; `NO-GO` rows must provide non-empty `failure_mode`.
5. Validation remains unchanged and must pass: `make test`, `make test-sidecar`, `make lint`.

## Invariants
- `canonical_event_id_unique`
- `replay_idempotent`
- `cursor_monotonic`
- `signed_delta_conservation`
- `chain_adapter_runtime_wired`

## C0103 decision hook
- `DP-0120-C0103`: C0103 remains blocked if any mandatory-chain required row in either artifact is missing, reports `outcome=NO-GO`, has `evidence_present=false`, any required invariant gate false, or required peer deltas are non-zero.
