groups:
  - name: multichain-indexer
    rules:
      - alert: IngesterHighErrorRate
        expr: rate(indexer_ingester_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Ingester error rate is high"
          description: "{{ $labels.chain }}/{{ $labels.network }} ingester error rate: {{ $value }}/s"
      - alert: FetcherHighErrorRate
        expr: rate(indexer_fetcher_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Fetcher error rate is high"
      - alert: NormalizerHighErrorRate
        expr: rate(indexer_normalizer_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Normalizer error rate is high"
      - alert: IngesterLatencyHigh
        expr: histogram_quantile(0.99, rate(indexer_ingester_batch_duration_seconds_bucket[5m])) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Ingester P99 latency > 5s"
      - alert: CursorStalled
        expr: changes(indexer_pipeline_cursor_sequence[10m]) == 0
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Pipeline cursor has not advanced in 10m"
      - alert: DBPoolExhausted
        expr: indexer_postgres_db_pool_in_use / indexer_postgres_db_pool_open > 0.9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "DB connection pool utilization > 90%"
